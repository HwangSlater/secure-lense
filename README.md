# SecureLens 🔒

**AI 기반 악성코드 및 스피어피싱 분석 플랫폼**

SecureLens는 의심스러운 파일과 URL을 안전하게 분석하여 악성코드 여부를 확인할 수 있는 웹 기반 보안 분석 서비스입니다. 전문가 수준의 기술 분석과 AI 기반 설명을 제공하여 누구나 쉽게 위협을 이해하고 대응할 수 있습니다.

---

## 🎯 SecureLens가 하는 일

### 파일 분석
의심스러운 파일(.exe, .dll, .pdf, .docx, .eml 등)을 업로드하면:
- ✅ **다중 보안 엔진 스캔**: ClamAV, YARA, 바이너리 분석을 동시에 실행
- ✅ **위험도 점수 계산**: 0-100점으로 악성 가능성 평가
- ✅ **AI 심층 분석**: Gemini AI가 위협을 쉽게 설명하고 대응 방법 제시
- ✅ **외부 위협 인텔리전스**: VirusTotal, MalwareBazaar 등과 연동하여 추가 정보 제공

### URL 분석
이메일에 포함된 링크나 의심스러운 URL을 입력하면:
- ✅ **실시간 URL 스캔**: URLScan.io를 통한 위협 분석
- ✅ **도메인/IP 정보**: 지오로케이션 및 ISP 정보 확인
- ✅ **악성 URL 탐지**: 악성 사이트로 판단된 경우 즉시 경고

---

## ✨ 주요 기능

### 1. 다중 엔진 악성코드 스캔
- **ClamAV**: 바이러스 시그니처 기반 탐지
- **YARA**: 패턴 매칭 규칙으로 악성코드 특징 탐지
- **바이너리 분석**: 쉘코드 패턴, 의심스러운 문자열, PE 헤더 이상 탐지
- **엔트로피 분석**: 파일 패킹/암호화 탐지 (0-8.0 척도)
- **파일 타입 검증**: 실제 파일 시그니처 기반 확장자 위조 탐지
- **Office 문서 분석**: VBA 매크로, 자동 실행 매크로, 의심 키워드 탐지
- **PDF 분석**: JavaScript, 인터랙티브 요소, 임베디드 파일 탐지
- **ZIP 분석**: 내부 파일 분석, 이중 확장자, 암호화, 중첩 아카이브 탐지
- **PE 강화 분석**: LIEF 기반 섹션 엔트로피, API 임포트, 섹션 특성 분석
- **문자열 추출 강화**: URL, IP 주소, 이메일 주소 자동 추출
- **외부 API 통합**: VirusTotal, MalwareBazaar와 연동하여 추가 검증

### 2. 스피어피싱 탐지
- 이메일 헤더 분석 (From, Reply-To, Return-Path)
- 발신자 위조 탐지
- 한국어 피싱 키워드 탐지
- 의심스러운 URL 추출 및 분석
- 이중 확장자 탐지 (예: invoice.pdf.exe)

### 3. AI 기반 위협 설명
- **Gemini 2.5 Flash**를 활용한 한국어 설명
- 위험도 평가 및 구체적인 대응 방법 제시
- 실제 공격 사례 참조
- 일반인도 이해하기 쉬운 설명

### 4. 외부 위협 인텔리전스
- **VirusTotal**: 다수의 백신 엔진 탐지 결과
- **MalwareBazaar**: 악성코드 샘플 데이터베이스 검색
- **URLScan.io**: URL 실시간 스캔 및 스크린샷
- **IP-API**: IP 주소 지오로케이션 정보

### 5. 사용자 관리
- **크레딧 시스템**: AI 분석은 티켓으로 사용 (관리자는 무제한)
- **분석 이력**: 모든 분석 내역을 마이페이지에서 확인
- **결제 내역**: 티켓 구매 기록 추적

---

## 📊 위험도 평가 시스템

### 위험도 점수 (0-100점)

| 항목 | 점수 |
|------|------|
| ClamAV 탐지 | +40점 |
| YARA 매칭 | +30점 (최대) |
| PE 헤더 이상 | +15점 |
| PE 강화 분석 이상 | +20점 (최대) |
| 쉘코드 패턴 | +20점 |
| 의심스러운 문자열 | +10~15점 (3개 이상) |
| 엔트로피 (7.5 이상) | +20점 |
| 엔트로피 (7.0-7.5) | +15점 |
| 엔트로피 (6.5-7.0) | +10점 |
| 파일 타입 불일치 | +15점 |
| Office 자동 실행 매크로 | +20점 |
| Office 매크로 | +15점 |
| PDF JavaScript | +15점 |
| ZIP 의심 파일 | +15점 (최대) |
| VirusTotal 탐지 | +10~25점 (탐지 비율에 따라) |
| MalwareBazaar 매칭 | +20점 |
| 악성 URL 탐지 | +15점 |
| 스피어피싱 지표 | +10~20점 |

### 위험도 등급

- 🟢 **매우 낮음** (0-20): 안전한 파일로 판단
- 🟡 **낮음** (21-40): 주의 깊게 확인 필요
- 🟠 **보통** (41-60): 악성 징후 발견, 실행 금지
- 🔴 **높음** (61-80): 즉시 격리 또는 삭제 권장
- ⚫ **매우 높음** (81-100): 악성코드로 판단, 즉시 조치 필요

---

## 🚀 빠른 시작

### 1. 파일 분석하기
1. 대시보드에 접속
2. 파일을 드래그 앤 드롭하거나 클릭하여 업로드
3. 자동으로 분석 시작
4. 결과 페이지에서 위험도 및 상세 분석 확인
5. (선택) 티켓을 사용하여 AI 심층 분석 요청

### 2. URL 분석하기
1. 대시보드의 "URL 분석" 섹션으로 이동
2. 의심스러운 URL 입력
3. URLScan.io를 통한 실시간 스캔 수행
4. 위협 점수 및 상세 정보 확인

### 3. AI 심층 분석
1. 분석 결과 페이지에서 "AI 심층 분석" 섹션 확인
2. 보유 티켓이 있으면 "티켓 1개로 분석 보기" 클릭
3. 티켓이 없으면 "티켓 구매" 페이지에서 구매
4. AI가 제공하는 상세 분석 및 대응 방법 확인

---

## 📁 지원 파일 형식

| 형식 | 확장자 | 설명 |
|------|--------|------|
| 실행 파일 | `.exe`, `.dll` | Windows 실행 파일 및 라이브러리 |
| 문서 | `.pdf`, `.docx` | PDF 및 Word 문서 |
| 이메일 | `.eml` | 이메일 파일 |
| 압축 파일 | `.zip` | ZIP 아카이브 |

**파일 크기 제한**: 최대 50MB

---

## 🔐 사용자 계정

### 기본 계정

| 역할 | 사용자명 | 비밀번호 | 권한 |
|------|----------|----------|------|
| 관리자 | `admin` | `admin123` | 무제한 AI 분석 접근 |
| 일반 사용자 | `user` | `user123` | 티켓 충전 후 AI 분석 가능 |

> ⚠️ 프로덕션 환경에서는 반드시 비밀번호를 변경하세요!

---

## 🛡️ 보안 기능

### 파일 안전성
- ✅ **정적 분석만 수행**: 파일을 실행하지 않고 구조만 분석
- ✅ **격리 저장**: 업로드된 파일은 격리된 디렉토리에 저장
- ✅ **자동 삭제**: 분석 완료 후 1시간 뒤 자동 삭제
- ✅ **크기 제한**: 최대 50MB로 제한
- ✅ **확장자 화이트리스트**: 허용된 파일 형식만 업로드 가능

### API 보안
- ✅ **JWT 인증**: 토큰 기반 인증 시스템
- ✅ **속도 제한**: IP당 시간당 10개 업로드 제한
- ✅ **입력 검증**: 모든 입력값 검증 및 정제
- ✅ **타임아웃 보호**: 모든 스캔에 30초 타임아웃 설정
- ✅ **오류 처리**: 사용자 친화적인 에러 메시지

---

## 🏗️ 기술 스택

### Backend
- **FastAPI**: 고성능 Python 웹 프레임워크
- **SQLAlchemy**: ORM 및 데이터베이스 관리
- **YARA**: 패턴 매칭 엔진
- **ClamAV**: 바이러스 스캔 엔진 (별도 컨테이너)
- **pefile**: PE 파일 구조 분석
- **oletools**: Office 문서 VBA 매크로 분석
- **PyPDF2**: PDF 파일 분석
- **python-magic**: 파일 타입 검증
- **LIEF**: PE 파일 강화 분석
- **Google Gemini 2.5 Flash**: AI 분석

### Frontend
- **Next.js**: React 기반 프레임워크
- **TypeScript**: 타입 안전성
- **Tailwind CSS**: 유틸리티 우선 CSS

### Infrastructure
- **Docker**: 컨테이너화
- **MySQL**: 데이터베이스
- **Nginx**: 리버스 프록시

### 외부 API 통합
- **VirusTotal**: 파일 해시 검색
- **Abuse.ch MalwareBazaar**: 악성코드 샘플 정보
- **URLScan.io**: URL 스캔
- **IP-API**: IP 지오로케이션

---

## 📦 프로젝트 구조

```
secure/
├── backend/                 # FastAPI 백엔드
│   ├── main.py             # API 라우트 및 비즈니스 로직
│   ├── models.py           # 데이터베이스 모델
│   ├── auth.py             # JWT 인증
│   ├── analyzer.py         # 핵심 분석 엔진
│   ├── external_apis.py   # 외부 API 통합
│   ├── entrypoint.sh       # ClamAV + FastAPI 시작 스크립트
│   └── rules/              # YARA 규칙 파일
├── frontend/               # Next.js 프론트엔드
│   ├── app/                # 페이지 라우팅
│   │   ├── dashboard/      # 대시보드 (파일/URL 업로드)
│   │   ├── result/         # 분석 결과 페이지
│   │   ├── credits/        # 티켓 구매 페이지
│   │   └── mypage/         # 마이페이지
│   └── components/         # React 컴포넌트
│       ├── FileUpload.tsx  # 파일 업로드
│       ├── URLAnalyzer.tsx # URL 분석
│       ├── AnalysisResult.tsx # 분석 결과 표시
│       └── AIInsight.tsx   # AI 분석 표시
├── docker-compose.yml      # 로컬 개발용
├── docker-compose.app.yml  # 프로덕션 배포용
└── .github/workflows/      # CI/CD 파이프라인
```

---

## 🚀 배포 및 실행

### 로컬 개발 환경

```bash
# 1. 저장소 클론
git clone <repository-url>
cd secure

# 2. 환경 변수 설정 (.env 파일 생성)
cp .env.example .env
# .env 파일에 필요한 API 키 설정

# 3. Docker Compose로 실행
docker compose up -d

# 4. 접속
# Frontend: http://localhost:3000
# Backend API: http://localhost:8000
```

### 프로덕션 배포

자세한 배포 가이드는 `.github/workflows/deploy.yml`을 참고하세요.

---

## ⚙️ 환경 변수 설정

필수 환경 변수:
- `GEMINI_API_KEY`: Google Gemini API 키
- `JWT_SECRET`: JWT 토큰 서명 키
- `MYSQL_ROOT_PASSWORD`: MySQL 루트 비밀번호
- `MYSQL_PASSWORD`: MySQL 사용자 비밀번호

선택사항 (외부 API 통합):
- `VIRUSTOTAL_API_KEY`: VirusTotal API 키
- `URLSCAN_API_KEY`: URLScan.io API 키

자세한 설정 방법은 프로젝트 루트의 환경 변수 설정 가이드를 참고하세요.

---

## 📝 주요 사용 시나리오

### 시나리오 1: 의심스러운 이메일 첨부파일 분석
1. 이메일에서 첨부파일 다운로드
2. SecureLens에 파일 업로드
3. 위험도 점수 확인
4. AI 심층 분석으로 상세 위협 정보 확인
5. 대응 방법에 따라 조치

### 시나리오 2: 피싱 이메일 링크 확인
1. 이메일에 포함된 URL 복사
2. SecureLens의 URL 분석에 입력
3. URLScan.io 스캔 결과 확인
4. 악성 URL인 경우 즉시 접속 중단

### 시나리오 3: 다운로드한 파일 검증
1. 인터넷에서 다운로드한 실행 파일 업로드
2. VirusTotal 및 MalwareBazaar 연동 결과 확인
3. PE 헤더 이상 및 의심스러운 패턴 확인
4. 안전 여부 판단 후 실행 여부 결정

---

## ⚠️ 중요 사항

1. **파일 실행 금지**: SecureLens는 정적 분석 도구입니다. 업로드된 파일을 실행하지 마세요.
2. **프로덕션 배포**: 실제 운영 환경에서는 반드시 보안 설정을 강화하고 API 키를 안전하게 관리하세요.
3. **API 키 관리**: 외부 API 키는 환경 변수로 관리하고 Git에 커밋하지 마세요.
4. **파일 자동 삭제**: 업로드된 파일은 1시간 후 자동으로 삭제됩니다.
5. **ClamAV 통합**: ClamAV는 Backend 컨테이너 내부에서 실행되며, 별도의 컨테이너가 필요 없습니다.

---

## 📚 추가 문서

- [시스템 아키텍처](./ARCHITECTURE.md) - 전체 시스템 아키텍처 및 구성 요소 설명
- [분석 가이드](./ANALYSIS_GUIDE.md) - 일반 분석 및 AI 분석 동작 방식 상세 설명
- [외부 API 통합 가이드](./README_EXTERNAL_APIS.md) - VirusTotal, URLScan.io 등 설정 방법
- [환경 변수 설정 가이드](./ENV_SETUP_GUIDE.md) - API 키 및 환경 변수 설정

---

## 📄 라이선스

이 프로젝트는 교육 및 보안 연구 목적으로만 사용됩니다.

---

**보안 전문가를 위해 ❤️로 만들어졌습니다**
